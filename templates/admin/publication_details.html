{% extends 'web/base.html' %}
{% load static %}

{% block title %}Proxynet - {{ publication.title }}{% endblock %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-3">
      {% if publication.image %}
        <img src="{{ publication.image.url }}" class="img-fluid rounded" alt="Publication Image">
      {% endif %}
      <p class="mt-3">Posted by: <a href="{% url 'user-details' publication.user.pk %}" class="text-decoration-none">{{ publication.user.username }}</a></p>
      <p class="mb-2">Likes: <span class="badge bg-primary text-white">{{ publication.likes.count }}</span></p>
      <p class="mb-2">Dislikes: <span class="badge bg-danger text-white">{{ publication.dislikes.count }}</span></p>
      {% if publication.coordinates %}
        <p class="mb-2">Coordinates: {{ publication.coordinates.latitude }}, {{ publication.coordinates.longitude }}</p>
        <a href="https://maps.google.com/?q={{ publication.coordinates.latitude }},{{ publication.coordinates.longitude }}" target="_blank" class="btn btn-primary">View on Google Maps</a>
      {% endif %}
      <p class="mb-2">Created at: {{ publication.created_at }}</p>
      <p class="mb-2">Updated at: {{ publication.updated_at }}</p>
    </div>
    <div class="col-md-9">
      <h1>{{ publication.title }}</h1>
      <p class="lead">{{ publication.text }}</p>
    </div>
  </div>

  <h2 class="mt-4">Comments</h2>
  <ul class="list-group">
    {% for comment in comments %}
    <li class="list-group-item">
      <p>{{ comment.text }}</p>
      <p class="mb-0">Commented by: <a href="{% url 'user-details' comment.user.pk %}" class="text-decoration-none">{{ comment.user.username }}</a></p>

      {% if comment.replies.count > 0 %}
        <ul class="list-group mt-2">
          {% for reply in comment.replies.all %}
          <li class="list-group-item">
            <p>{{ reply.text }}</p>
            <p class="mb-0">Replied by: <a href="{% url 'user-details' reply.user.pk %}" class="text-decoration-none">{{ reply.user.username }}</a></p>
          </li>
          {% endfor %}
        </ul>
      {% endif %}
    </li>
    {% empty %}
    <li class="list-group-item">No comments yet.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
